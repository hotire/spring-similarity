package com.github.hotire.spring.similarity;

import static org.assertj.core.api.Assertions.assertThat;

import org.junit.jupiter.api.Test;

class SimHashUtilsTest {

    @Test
     void preprocess() {
        final String source = "※アヴリル・ラヴィーンコースの賞品は選べません。" +
                              "※画像はイメージです。		内容は変更になる場合があります。応募期間 応募方法 ①キャンペーンページにア クセスし、 ";
        final String expected = "※アヴリル・ラヴィーンコースの賞品は選べません。 ※画像はイメージです。 内容は変更になる場合があります。 応募期間 応募方法 ①キャンペーンページにア クセスし、";
        final String result = source.replaceAll("[.!,?)\"']+|[！，。？、~…）]+", "$0 ")
                                    .trim()
                                    .replaceAll("\\s+",  " ");

        assertThat(result).isEqualTo(expected);
    }

    @Test
    void simHash() {
        // given
        final String source = "お住まいの場所に合ったコンテンツを表示させ、オンラインで購入できるようにするには、国または地域を選んでください。 日本 日本 ほかの国または地域を選ぶ 続ける Global Nav Open Menu Global Nav Close Menu Apple Shopping Bag Search apple.com Cancel Apple Mac iPad iPhone Watch TV Music Support Shopping Bag Cancel  Quick Links COVID-19 Information Apple Store Closure FAQ Today at Apple Accessories AirPods iPhone SE  Local Nav Open Menu Local Nav Close Menu Overview Why Upgrade Tech Specs Buy iPhone SE iPhone SE Lots to love. Less to spend. iPhone SE packs our most powerful chip into our most popular size at our most affordable price. It’s just what you’ve been waiting for.  Starting at $399.  From nine dollars and fifty four cents per month or two hundred and twenty nine dollars with trade in. From $9.54/mo. or $229 with trade-in. See iPhone SE in AR See iPhone SE in AR Durable glass and aluminum design Brilliant 4.7” Retina HD display A13 Bionic iPhone 11 Pro called. It wants its chip back. We put the brains of iPhone 11 Pro in the body of iPhone SE. A13 Bionic is the fastest chip ever in a smartphone, period. So everything feels fluid, whether you’re launching apps, playing the latest games, or exploring new ways to work and play with augmented reality. We put the brains of iPhone 11 Pro in the body of iPhone SE. A13 Bionic is the fastest chip ever in a smartphone, period. So everything feels fluid, whether you’re launching apps, playing the latest games, or exploring new ways to work and play with augmented reality. Portrait Mode Smile, you’re in Portrait mode. The advanced camera system with A13 Bionic brings you Portrait mode, which artfully blurs the background to put the focus on your subject — even when you’re taking selfies. The advanced camera system with A13 Bionic brings you Portrait mode, which artfully blurs the background to put the focus on your subject — even when you’re taking selfies. Depth Control. A simple slider lets you blur the background as much or as little as you like — before or after you take the photo. Portrait Lighting. Choose from six studio‑quality effects, then adjust the lighting intensity to show your subject in the best possible light. Studio Light Natural Light Contour Light Stage Light Mono Stage Light High‑Key Light Mono Smart HDR Let there be light. And shadow. And contour. Next‑generation Smart HDR knows a face when it sees one, and intelligently relights it to capture more natural-looking contours and skin tones. It also finesses highlight and shadow detail in the background. So every part of your photo looks amazing. Smart HDR 1 Smart HDR 2 Smart HDR 3 Smart HDR 4 Smart HDR 5 Smart HDR 6 High, high, high, high‑definition video. Animation of 4k video QuickTake. When a photo op turns into a video op, you can instantly start recording video by just holding the shutter. Touch ID Home sweet Home button. Touch ID animation Touch ID Home sweet Home button. Touch ID lets you securely unlock your iPhone and sign in to apps instantly. You can even use it with Apple Pay to grab a coffee, get a yoga app, or shop for sneakers online. All without reaching for your credit card. Privacy Privacy is built in. Everything we make is designed to give you control over your information. All the iMessages you send are encrypted. Fingerprint data is stored on your device, never on Apple servers or in iCloud. Apple Pay doesn’t share your credit card number. And the list goes on. Learn more about privacy Water Resistance Survives splashes, sloshes, sprinkles, sprays, splatters, and spills. iPhone SE is water resistant to 1 meter for 30 minutes. It’s not afraid of a little coffee, tea, or soda either. And dust? No worries. Battery Binge‑worthy battery life. The show must go on. So iPhone SE lets you watch up to 13 hours of video on a single charge. When you do need to power up, just set it down on a wireless charger. Or connect to an 18W fast-charge adapter to go from zero to up to 50 percent in 30 minutes. iOS 13 Built for iOS 13. And beyond. iPhone SE is made to run the latest features — and even some that haven’t been invented yet. So you can use Dark Mode, Siri Shortcuts, and the new Photos app now. And take advantage of feature and security updates in the future. Learn more about iOS 13 Colors Comes in Black. Comes in Black. iPhone SE in black Comes in White. Comes in Black. White. iPhone SE in white Comes in Pow. Comes in Black. White. And Pow. iPhone SE in red Other Features Even more great stuff. True Tone Dynamically adjusts white balance on the display so images look natural and are easier on your eyes. Haptic Touch Press and hold an icon for shortcuts and a slight vibration makes it feel like you’re pressing a real, physical button. Augmented reality Run the latest AR apps that let you measure real‑world objects, map constellations over the stars, and more. Stereo audio recording iPhone SE records videos in stereo to make the sound as engaging as the picture. Faster Wi‑Fi and cellular data Wi‑Fi 6 and Gigabit‑class LTE can deliver much faster download speeds, whether you’re on Wi‑Fi or cellular networks. Audio Sharing You and a friend can both rock out to the same playlist by pairing two sets of AirPods or Beats headphones to one iPhone. Dual SIM, dual numbers Dual SIM with eSIM lets you have both a business number and a personal number on the same iPhone. AR Use AR to see iPhone SE. Open this page using Safari on your iPhone or iPad. See iPhone SE in AR See iPhone SE in AR Black White (PRODUCT)RED Accessories Explore iPhone accessories. Shop iPhone accessories Why Upgrade Why it’s worth upgrading from your iPhone to iPhone SE. See what you’re missing Have an Android? See why you should switch Get credit toward a new iPhone SE. With Apple Trade In, you can get credit toward iPhone SE when you trade in your eligible smartphone. Trade in multiple devices for even more credit. It’s good for you and the planet.  Learn more about Apple trade in The smartest way to buy your next iPhone. Apple Card Monthly Installments lets you pay for your new iPhone over time, interest‑free. You’ll get 3% Daily Cash back, which is automatically added to your Apple Cash card in the Wallet app. Learn more about Apple Card Installments Why Apple is the best place to buy. Have questions about carriers, payments, or anything else iPhone? Just say the word. Learn more about buying iPhone Apple Footer Fast, free, no‑contact delivery And free returns. See checkout for delivery dates. Learn more Find the card for you Get 3% Daily Cash with Apple Card or get special financing. Learn more Get help buying Have a question? Call a Specialist or chat online. Call 1-800-MY-APPLE. Contact us Trade In: Trade‑in values vary. iPhone SE promotional pricing is after trade-in of iPhone 8 in good condition. Additional trade‑in values require purchase of a new iPhone, subject to availability and limits. Must be at least 18. Apple or its trade-in partners reserve the right to refuse or limit any Trade In transaction for any reason. In‑store trade‑in requires presentation of a valid, government-issued photo ID (local law may require saving this information). Sales tax may be assessed on full value of new iPhone. Additional terms from Apple or Apple’s trade-in partners may apply. Monthly pricing: Available to qualified customers and requires 0% APR, 24-month installment loan with Citizens One or Apple Card Monthly Installments and iPhone activation with AT&T, Sprint, T-Mobile, or Verizon. Taxes and shipping not included. Additional Apple Card Monthly Installments terms are in the Customer Agreement . Additional iPhone Payments terms are here iPhone SE is splash, water, and dust resistant and was tested under controlled laboratory conditions with a rating of IP67 under IEC standard 60529 (maximum depth of 1 meter up to 30 minutes). Splash, water, and dust resistance are not permanent conditions and resistance might decrease as a result of normal wear. Do not attempt to charge a wet iPhone; refer to the user guide for cleaning and drying instructions. Liquid damage not covered under warranty. All battery claims depend on network configuration and many other factors; actual results will vary. Battery has limited recharge cycles and may eventually need to be replaced by Apple service provider. Battery life and charge cycles vary by use and settings. See apple.com/batteries and  apple.com/iphone/battery.html for more information. Wireless charger and 18W fast-charge adapter sold separately. Testing conducted by Apple in February 2020 using preproduction iPhone SE (2nd generation) units and software and accessory Apple USB-C Power Adapters (18W Model A1720 and 30W Model A1882). Fast-charge testing conducted with drained iPhone units. Charge time varies with environmental factors; actual results will vary. Data plan required. Gigabit‑class LTE is available in select markets and through select carriers. Speeds are based on theoretical throughput and vary based on site conditions and carrier. For details on LTE support, contact your carrier and see apple.com/iphone/LTE. Compatible with AirPods (1st generation or later), Powerbeats Pro, Beats Solo3 Wireless, BeatsX, Beats Studio3 Wireless, and Powerbeats3 Wireless and requires the latest version of iOS. Use of eSIM requires a wireless service plan (which may include restrictions on switching service providers and roaming, even after contract expiration). Not all carriers support eSIM. Use of eSIM in iPhone may be disabled when purchased from some carriers. See your carrier for details. To learn more, visit support.apple.com/kb/HT209044. Trade-in values may vary, and are based on the condition and model of your trade‑in device. Additional trade‑in values require purchase of a new iPhone, subject to availability and limits. Must be at least 18. Offer may not be available in all stores and not all devices are eligible for credit. Apple or its trade-in partners reserve the right to refuse or limit any Trade In transaction for any reason. In‑store trade‑in requires presentation of a valid, government‑issued photo ID (local law may require saving this information). Sales tax may be assessed on full value of new iPhone. Value of your current device may be applied toward purchase of a new Apple device. Additional terms from Apple or Apple’s trade‑in partners may apply. See apple.com/shop/trade-in for more information. Apple Arcade requires a subscription. Some features may not be available for all countries or all areas. View complete list. Apple iPhone iPhone SE Shop and Learn Open Menu Close Menu Mac iPad iPhone Watch TV Music AirPods HomePod iPod touch Accessories Gift Cards Services Open Menu Close Menu Apple Music Apple News+ Apple TV+ Apple Arcade Apple Card iCloud Account Open Menu Close Menu Manage Your Apple ID Apple Store Account iCloud.com Apple Store Open Menu Close Menu Find a Store Genius Bar Today at Apple Apple Camp Field Trip Apple Store App Refurbished and Clearance Financing Apple Trade In Order Status Shopping Help For Business Open Menu Close Menu Apple and Business Shop for Business For Education Open Menu Close Menu Apple and Education Shop for K-12 Shop for College For Healthcare Open Menu Close Menu Apple in Healthcare Health on Apple Watch Health Records on iPhone For Government Open Menu Close Menu Shop for Government Shop for Veterans and Military Apple Values Open Menu Close Menu Accessibility Education Environment Inclusion and Diversity Privacy Supplier Responsibility About Apple Open Menu Close Menu Newsroom Apple Leadership Job Opportunities Investors Events Contact Apple More ways to shop:  Find an Apple Store or  other retailer near you.  Or call 1-800-MY-APPLE. United States Copyright © 2020 Apple Inc. All rights reserved. Privacy Policy Terms of Use Sales and Refunds Legal Site Map";
        final String replaced = source.replaceAll("[.!,?)\"']+|[！，。？、~…）]+", "$0 ")
                                      .trim()
                                      .replaceAll("\\s+",  " ");
        final long result = SimHashUtils.simhash32(replaced);

        assertThat(result).isEqualTo(2728770051L);
    }
}